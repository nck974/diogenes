<mat-toolbar>
    <mat-toolbar-row>
        <button mat-button (click)="onNavigateBack()">
            <mat-icon>arrow_back</mat-icon>
        </button>
    </mat-toolbar-row>
</mat-toolbar>

<div *ngIf="isLoading; else notLoading">
    <app-loading-spinner></app-loading-spinner>
</div>

<ng-template #notLoading>

    <div *ngIf="initializationError; else itemFormTemplate">
        <app-error-card [title]="'Item not found'" [icon]="'error'"
            [content]="initializationError"></app-error-card>
    </div>

    <ng-template #itemFormTemplate>

        <div class="center">
            <mat-card align="center" class="card">

                <mat-card-title class="center title">
                    {{isNewItem ? "Create item" : "Edit item"}}
                </mat-card-title>

                <!-- Item Image -->

                <!-- Hidden form to select files -->
                <input #fileInput type="file"
                    accept="image/gif, image/jpeg, image/png"
                    (change)="onFileSelected($event)"
                    style="display: none">
                
                <!-- Show actual image -->
                <div class="item-image-container"
                    *ngIf="imagePath && !selectedImage; else addNewImageTemplate">
                    <img src="{{imagePath}}"
                        class="item-image"
                        alt="item-image">
                    <div class="item-image-buttons-container">
                        <button mat-icon-button class="edit-button"
                            (click)="fileInput.click()">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button class="delete-button"
                            (click)="onDeleteImage()">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>

                <!-- New Image Form -->
                <ng-template #addNewImageTemplate>
                    <!-- Preview -->
                    <div class="item-image-container"
                        *ngIf="selectedImage; else addImageForm">
                        <img [src]="selectedImage"
                            class="item-image"
                            alt="selected-image">
                        <div class="item-image-buttons-container">
                            <button mat-icon-button class="delete-button"
                                (click)="onFileDeselected()">
                                <mat-icon>delete</mat-icon>
                            </button>
                        </div>
                    </div>

                    <!-- Form -->
                    <ng-template #addImageForm>
                        <label for="file-input">
                            <div class="item-add-new-image-container">
                                <button mat-icon-button class="add-image-button"
                                    (click)="fileInput.click()">
                                    <mat-icon>add_a_photo</mat-icon>
                                </button>
                            </div>
                        </label>
                    </ng-template>

                </ng-template>

                <!-- JSON form -->
                <form class="form" [formGroup]="itemForm"
                    (ngSubmit)="onSubmit()">

                    <br>

                    <mat-form-field>
                        <mat-label>Name</mat-label>
                        <input matInput required maxlength="50"
                            formControlName="name">
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label>Description</mat-label>
                        <textarea matInput formControlName="description"
                            class="textarea-height"
                            maxlength="2000"></textarea>
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label>Number</mat-label>
                        <input matInput required maxlength="50"
                            formControlName="number" type="number">
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label>Category</mat-label>
                        <mat-select formControlName="categoryId">
                            <mat-option *ngFor="let category of categories"
                                [value]="category.id">
                                {{ category.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <div class="center">
                        <button mat-raised-button color="primary" type="submit"
                            [disabled]="itemForm.invalid">{{isNewItem ? "Submit"
                            : "Save"}}</button>
                    </div>

                </form>
            </mat-card>
        </div>

    </ng-template>

</ng-template>